worker_processes 1; # Adjust based on your system if needed

events {
    worker_connections 1024;
}

http {
    # Define upstream server (our MinIO container)
    upstream minio_server {
        # Use the Docker service name and internal port
        server minio:9000;
    }

    server {
        listen 80; # Nginx listens on port 80 inside the container
        server_name localhost; # Or your specific domain if using one

        # Increase max body size for potential large uploads if proxying writes later
        client_max_body_size 0; # 0 = unlimited, adjust as needed

        location / {
            # Pass requests to the upstream MinIO server
            proxy_pass http://minio_server;

            # Set headers to ensure MinIO gets correct info
            proxy_set_header Host $http_host; # Pass the original host header (e.g., localhost:9000)
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # Important for pre-signed URLs and MinIO operations
            proxy_connect_timeout       300;
            proxy_send_timeout          300;
            proxy_read_timeout          300;
            send_timeout                300;
            proxy_http_version          1.1;
            proxy_set_header            Connection ""; # Allow keep-alive
            chunked_transfer_encoding   off; # Recommended for MinIO compatibility
        }
    }
}
